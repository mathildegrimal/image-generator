/*!
 * MIT License
 * 
 * Copyright (c) 2021 Yoav Niran
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.rpldy=t(require("react"),require("react-dom")):e.rpldy=t(e.react,e["react-dom"])}(window,(function(e,t){return function(e){function t(t){for(var r,s,i=t[0],u=t[1],d=t[2],l=0,f=[];l<i.length;l++)s=i[l],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&f.push(o[s][0]),o[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(c&&c(t);f.length;)f.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var u=n[i];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={main:0},a=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonprpldy=window.webpackJsonprpldy||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var c=u;return a.push(["MIuT","polyfills"]),n()}({DVTP:function(e,t){e.exports=function(){return!0}},Lrr1:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return u}));var r=n("mHo/");const o=Symbol.for("_rpldy-version_"),a=()=>"0.17.2",s=()=>(Object(r.hasWindow)()?window:e)[o],i=()=>{(Object(r.hasWindow)()?window:e)[o]=a()},u=()=>{const e=s();return!!e&&e!==a()}}).call(this,n("8oxB"))},MIuT:function(e,t,n){"use strict";n.r(t),n.d(t,"chunkedSender",(function(){return a})),n.d(t,"lifeEvents",(function(){return s})),n.d(t,"mockSender",(function(){return i})),n.d(t,"retry",(function(){return d})),n.d(t,"safeStorage",(function(){return c})),n.d(t,"sender",(function(){return r})),n.d(t,"shared",(function(){return O})),n.d(t,"simpleState",(function(){return o})),n.d(t,"tusSender",(function(){return l})),n.d(t,"uploader",(function(){return u})),n.d(t,"chunkedUploady",(function(){return g})),n.d(t,"retryHooks",(function(){return h})),n.d(t,"sharedUi",(function(){return f})),n.d(t,"tusUploady",(function(){return b})),n.d(t,"uploadButton",(function(){return m})),n.d(t,"uploadDropZone",(function(){return S})),n.d(t,"uploadPaste",(function(){return E})),n.d(t,"uploadPreview",(function(){return v})),n.d(t,"uploadUrlInput",(function(){return T})),n.d(t,"uploady",(function(){return p}));var r={};n.r(r),n.d(r,"default",(function(){return U})),n.d(r,"send",(function(){return D})),n.d(r,"getXhrSend",(function(){return P})),n.d(r,"XHR_SENDER_TYPE",(function(){return y})),n.d(r,"MissingUrlError",(function(){return A}));var o={};n.r(o),n.d(o,"default",(function(){return X})),n.d(o,"createState",(function(){return X})),n.d(o,"unwrap",(function(){return K})),n.d(o,"isProxy",(function(){return M})),n.d(o,"isProxiable",(function(){return $}));var a={};n.r(a),n.d(a,"default",(function(){return ge})),n.d(a,"CHUNK_EVENTS",(function(){return Y})),n.d(a,"CHUNKING_SUPPORT",(function(){return B})),n.d(a,"CHUNKED_SENDER_TYPE",(function(){return Q})),n.d(a,"CHUNKED_DEFAULT_OPTIONS",(function(){return j})),n.d(a,"getChunkedEnhancer",(function(){return pe})),n.d(a,"createChunkedSender",(function(){return fe})),n.d(a,"getChunkDataFromFile",(function(){return F}));var s={};n.r(s),n.d(s,"default",(function(){return Ue})),n.d(s,"addLife",(function(){return Ue})),n.d(s,"isLE",(function(){return Oe})),n.d(s,"createLifePack",(function(){return je}));var i={};n.r(i),n.d(i,"default",(function(){return xe})),n.d(i,"MOCK_SENDER_TYPE",(function(){return ke})),n.d(i,"createMockSender",(function(){return Ne})),n.d(i,"getMockSenderEnhancer",(function(){return He}));var u={};n.r(u),n.d(u,"default",(function(){return Ft})),n.d(u,"UPLOADER_EVENTS",(function(){return qe})),n.d(u,"DEFAULT_OPTIONS",(function(){return It})),n.d(u,"composeEnhancers",(function(){return Bt})),n.d(u,"createUploader",(function(){return kt})),n.d(u,"send",(function(){return D})),n.d(u,"getXhrSend",(function(){return P})),n.d(u,"XHR_SENDER_TYPE",(function(){return y})),n.d(u,"MissingUrlError",(function(){return A})),n.d(u,"FILE_STATES",(function(){return O.FILE_STATES})),n.d(u,"BATCH_STATES",(function(){return O.BATCH_STATES}));var d={};n.r(d),n.d(d,"default",(function(){return $t})),n.d(d,"retryEnhancer",(function(){return $t})),n.d(d,"RETRY_EVENT",(function(){return Ht})),n.d(d,"RETRY_EXT",(function(){return Nt}));var c={};n.r(c),n.d(c,"safeLocalStorage",(function(){return Gt})),n.d(c,"safeSessionStorage",(function(){return Wt}));var l={};n.r(l),n.d(l,"CHUNKING_SUPPORT",(function(){return B})),n.d(l,"TUS_SENDER_TYPE",(function(){return en})),n.d(l,"getTusEnhancer",(function(){return wn})),n.d(l,"clearResumables",(function(){return Zt})),n.d(l,"TUS_EXT",(function(){return Jt})),n.d(l,"default",(function(){return Pn}));var f={};n.r(f),n.d(f,"useBatchAddListener",(function(){return zn})),n.d(f,"useBatchStartListener",(function(){return Gn})),n.d(f,"useBatchProgressListener",(function(){return Qn})),n.d(f,"useBatchFinishListener",(function(){return Wn})),n.d(f,"useBatchCancelledListener",(function(){return Vn})),n.d(f,"useBatchAbortListener",(function(){return Yn})),n.d(f,"useBatchErrorListener",(function(){return Kn})),n.d(f,"useBatchFinalizeListener",(function(){return Xn})),n.d(f,"useItemStartListener",(function(){return Zn})),n.d(f,"useItemFinishListener",(function(){return Jn})),n.d(f,"useItemProgressListener",(function(){return or})),n.d(f,"useItemCancelListener",(function(){return er})),n.d(f,"useItemErrorListener",(function(){return tr})),n.d(f,"useItemAbortListener",(function(){return nr})),n.d(f,"useItemFinalizeListener",(function(){return rr})),n.d(f,"useRequestPreSend",(function(){return ar})),n.d(f,"useAllAbortListener",(function(){return sr})),n.d(f,"logWarning",(function(){return ur})),n.d(f,"markAsUploadOptionsComponent",(function(){return dr})),n.d(f,"getIsUploadOptionsComponent",(function(){return cr})),n.d(f,"generateUploaderEventHook",(function(){return $n})),n.d(f,"generateUploaderEventHookWithState",(function(){return Mn})),n.d(f,"getUploadyVersion",(function(){return Bn.c})),n.d(f,"NoDomUploady",(function(){return fr})),n.d(f,"assertContext",(function(){return Hn})),n.d(f,"UploadyContext",(function(){return Nn})),n.d(f,"createContextApi",(function(){return Fn})),n.d(f,"useUploadOptions",(function(){return pr})),n.d(f,"useAbortItem",(function(){return gr})),n.d(f,"useAbortBatch",(function(){return hr})),n.d(f,"useAbortAll",(function(){return br})),n.d(f,"useUploadyContext",(function(){return xn})),n.d(f,"useUploady",(function(){return xn})),n.d(f,"withRequestPreSendUpdate",(function(){return Sr})),n.d(f,"withBatchStartUpdate",(function(){return Er}));var p={};n.r(p),n.d(p,"default",(function(){return Rr})),n.d(p,"useFileInput",(function(){return Lr})),n.d(p,"Uploady",(function(){return Ar})),n.d(p,"UPLOADER_EVENTS",(function(){return qe})),n.d(p,"DEFAULT_OPTIONS",(function(){return It})),n.d(p,"composeEnhancers",(function(){return Bt})),n.d(p,"createUploader",(function(){return kt})),n.d(p,"send",(function(){return D})),n.d(p,"getXhrSend",(function(){return P})),n.d(p,"XHR_SENDER_TYPE",(function(){return y})),n.d(p,"MissingUrlError",(function(){return A})),n.d(p,"FILE_STATES",(function(){return O.FILE_STATES})),n.d(p,"BATCH_STATES",(function(){return O.BATCH_STATES})),n.d(p,"useBatchAddListener",(function(){return zn})),n.d(p,"useBatchStartListener",(function(){return Gn})),n.d(p,"useBatchProgressListener",(function(){return Qn})),n.d(p,"useBatchFinishListener",(function(){return Wn})),n.d(p,"useBatchCancelledListener",(function(){return Vn})),n.d(p,"useBatchAbortListener",(function(){return Yn})),n.d(p,"useBatchErrorListener",(function(){return Kn})),n.d(p,"useBatchFinalizeListener",(function(){return Xn})),n.d(p,"useItemStartListener",(function(){return Zn})),n.d(p,"useItemFinishListener",(function(){return Jn})),n.d(p,"useItemProgressListener",(function(){return or})),n.d(p,"useItemCancelListener",(function(){return er})),n.d(p,"useItemErrorListener",(function(){return tr})),n.d(p,"useItemAbortListener",(function(){return nr})),n.d(p,"useItemFinalizeListener",(function(){return rr})),n.d(p,"useRequestPreSend",(function(){return ar})),n.d(p,"useAllAbortListener",(function(){return sr})),n.d(p,"logWarning",(function(){return ur})),n.d(p,"markAsUploadOptionsComponent",(function(){return dr})),n.d(p,"getIsUploadOptionsComponent",(function(){return cr})),n.d(p,"generateUploaderEventHook",(function(){return $n})),n.d(p,"generateUploaderEventHookWithState",(function(){return Mn})),n.d(p,"getUploadyVersion",(function(){return Bn.c})),n.d(p,"NoDomUploady",(function(){return fr})),n.d(p,"assertContext",(function(){return Hn})),n.d(p,"UploadyContext",(function(){return Nn})),n.d(p,"createContextApi",(function(){return Fn})),n.d(p,"useUploadOptions",(function(){return pr})),n.d(p,"useAbortItem",(function(){return gr})),n.d(p,"useAbortBatch",(function(){return hr})),n.d(p,"useAbortAll",(function(){return br})),n.d(p,"useUploadyContext",(function(){return xn})),n.d(p,"useUploady",(function(){return xn})),n.d(p,"withRequestPreSendUpdate",(function(){return Sr})),n.d(p,"withBatchStartUpdate",(function(){return Er}));var g={};n.r(g),n.d(g,"default",(function(){return Pr})),n.d(g,"ChunkedUploady",(function(){return _r})),n.d(g,"CHUNK_EVENTS",(function(){return Y})),n.d(g,"useFileInput",(function(){return Lr})),n.d(g,"Uploady",(function(){return Ar})),n.d(g,"UPLOADER_EVENTS",(function(){return qe})),n.d(g,"DEFAULT_OPTIONS",(function(){return It})),n.d(g,"composeEnhancers",(function(){return Bt})),n.d(g,"createUploader",(function(){return kt})),n.d(g,"send",(function(){return D})),n.d(g,"getXhrSend",(function(){return P})),n.d(g,"XHR_SENDER_TYPE",(function(){return y})),n.d(g,"MissingUrlError",(function(){return A})),n.d(g,"FILE_STATES",(function(){return O.FILE_STATES})),n.d(g,"BATCH_STATES",(function(){return O.BATCH_STATES})),n.d(g,"useBatchAddListener",(function(){return zn})),n.d(g,"useBatchStartListener",(function(){return Gn})),n.d(g,"useBatchProgressListener",(function(){return Qn})),n.d(g,"useBatchFinishListener",(function(){return Wn})),n.d(g,"useBatchCancelledListener",(function(){return Vn})),n.d(g,"useBatchAbortListener",(function(){return Yn})),n.d(g,"useBatchErrorListener",(function(){return Kn})),n.d(g,"useBatchFinalizeListener",(function(){return Xn})),n.d(g,"useItemStartListener",(function(){return Zn})),n.d(g,"useItemFinishListener",(function(){return Jn})),n.d(g,"useItemProgressListener",(function(){return or})),n.d(g,"useItemCancelListener",(function(){return er})),n.d(g,"useItemErrorListener",(function(){return tr})),n.d(g,"useItemAbortListener",(function(){return nr})),n.d(g,"useItemFinalizeListener",(function(){return rr})),n.d(g,"useRequestPreSend",(function(){return ar})),n.d(g,"useAllAbortListener",(function(){return sr})),n.d(g,"logWarning",(function(){return ur})),n.d(g,"markAsUploadOptionsComponent",(function(){return dr})),n.d(g,"getIsUploadOptionsComponent",(function(){return cr})),n.d(g,"generateUploaderEventHook",(function(){return $n})),n.d(g,"generateUploaderEventHookWithState",(function(){return Mn})),n.d(g,"getUploadyVersion",(function(){return Bn.c})),n.d(g,"NoDomUploady",(function(){return fr})),n.d(g,"assertContext",(function(){return Hn})),n.d(g,"UploadyContext",(function(){return Nn})),n.d(g,"createContextApi",(function(){return Fn})),n.d(g,"useUploadOptions",(function(){return pr})),n.d(g,"useAbortItem",(function(){return gr})),n.d(g,"useAbortBatch",(function(){return hr})),n.d(g,"useAbortAll",(function(){return br})),n.d(g,"useUploadyContext",(function(){return xn})),n.d(g,"useUploady",(function(){return xn})),n.d(g,"withRequestPreSendUpdate",(function(){return Sr})),n.d(g,"withBatchStartUpdate",(function(){return Er})),n.d(g,"useChunkStartListener",(function(){return Cr})),n.d(g,"useChunkFinishListener",(function(){return wr}));var h={};n.r(h),n.d(h,"default",(function(){return Br})),n.d(h,"RETRY_EVENT",(function(){return Ht})),n.d(h,"retryEnhancer",(function(){return $t})),n.d(h,"useRetry",(function(){return Ur})),n.d(h,"useBatchRetry",(function(){return jr})),n.d(h,"useRetryListener",(function(){return kr}));var b={};n.r(b),n.d(b,"default",(function(){return Hr})),n.d(b,"TusUploady",(function(){return Fr})),n.d(b,"useClearResumableStore",(function(){return Nr})),n.d(b,"useFileInput",(function(){return Lr})),n.d(b,"Uploady",(function(){return Ar})),n.d(b,"UPLOADER_EVENTS",(function(){return qe})),n.d(b,"DEFAULT_OPTIONS",(function(){return It})),n.d(b,"composeEnhancers",(function(){return Bt})),n.d(b,"createUploader",(function(){return kt})),n.d(b,"send",(function(){return D})),n.d(b,"getXhrSend",(function(){return P})),n.d(b,"XHR_SENDER_TYPE",(function(){return y})),n.d(b,"MissingUrlError",(function(){return A})),n.d(b,"FILE_STATES",(function(){return O.FILE_STATES})),n.d(b,"BATCH_STATES",(function(){return O.BATCH_STATES})),n.d(b,"useBatchAddListener",(function(){return zn})),n.d(b,"useBatchStartListener",(function(){return Gn})),n.d(b,"useBatchProgressListener",(function(){return Qn})),n.d(b,"useBatchFinishListener",(function(){return Wn})),n.d(b,"useBatchCancelledListener",(function(){return Vn})),n.d(b,"useBatchAbortListener",(function(){return Yn})),n.d(b,"useBatchErrorListener",(function(){return Kn})),n.d(b,"useBatchFinalizeListener",(function(){return Xn})),n.d(b,"useItemStartListener",(function(){return Zn})),n.d(b,"useItemFinishListener",(function(){return Jn})),n.d(b,"useItemProgressListener",(function(){return or})),n.d(b,"useItemCancelListener",(function(){return er})),n.d(b,"useItemErrorListener",(function(){return tr})),n.d(b,"useItemAbortListener",(function(){return nr})),n.d(b,"useItemFinalizeListener",(function(){return rr})),n.d(b,"useRequestPreSend",(function(){return ar})),n.d(b,"useAllAbortListener",(function(){return sr})),n.d(b,"logWarning",(function(){return ur})),n.d(b,"markAsUploadOptionsComponent",(function(){return dr})),n.d(b,"getIsUploadOptionsComponent",(function(){return cr})),n.d(b,"generateUploaderEventHook",(function(){return $n})),n.d(b,"generateUploaderEventHookWithState",(function(){return Mn})),n.d(b,"getUploadyVersion",(function(){return Bn.c})),n.d(b,"NoDomUploady",(function(){return fr})),n.d(b,"assertContext",(function(){return Hn})),n.d(b,"UploadyContext",(function(){return Nn})),n.d(b,"createContextApi",(function(){return Fn})),n.d(b,"useUploadOptions",(function(){return pr})),n.d(b,"useAbortItem",(function(){return gr})),n.d(b,"useAbortBatch",(function(){return hr})),n.d(b,"useAbortAll",(function(){return br})),n.d(b,"useUploadyContext",(function(){return xn})),n.d(b,"useUploady",(function(){return xn})),n.d(b,"withRequestPreSendUpdate",(function(){return Sr})),n.d(b,"withBatchStartUpdate",(function(){return Er}));var m={};n.r(m),n.d(m,"default",(function(){return Mr})),n.d(m,"UploadButton",(function(){return qr})),n.d(m,"asUploadButton",(function(){return xr}));var S={};n.r(S),n.d(S,"default",(function(){return Wr})),n.d(S,"UploadDropZone",(function(){return Gr}));var E={};n.r(E),n.d(E,"withPasteUpload",(function(){return Kr})),n.d(E,"default",(function(){return Zr})),n.d(E,"usePasteUpload",(function(){return Qr}));var v={};n.r(v),n.d(v,"PREVIEW_TYPES",(function(){return Jr})),n.d(v,"default",(function(){return fo})),n.d(v,"getUploadPreviewForBatchItemsMethod",(function(){return co})),n.d(v,"UploadPreview",(function(){return lo}));var T={};n.r(T),n.d(T,"default",(function(){return ho})),n.d(T,"UploadUrlInput",(function(){return go}));var O=n("mHo/");const y="rpldy-sender";class A extends Error{constructor(e){super(e+" didn't receive upload URL"),this.name="MissingUrlError"}}const I=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];"set"in e?e.set(t,...r):("delete"in e&&e.delete(t),e.append(t,...r))};var L=(e,t)=>{const n=new FormData;return t.params&&Object.entries(t.params).forEach(e=>{let[r,o]=e;(t.formDataAllowUndefined||void 0!==o)&&I(n,r,o)}),((e,t,n)=>{const r=1===t.length;t.forEach((t,o)=>{const a=r?n.paramName:Object(O.isFunction)(n.formatGroupParamName)?n.formatGroupParamName(o,n.paramName):`${n.paramName}[${o}]`;t.file?I(e,a,t.file,t.file.name):t.url&&I(e,a,t.url)})})(n,e,t),n};const R=[200,201,202,203,204],_=(e,t,n,r,o)=>{let a;const s=null!=o&&o.getRequestData?o.getRequestData(e,n):((e,t)=>{let n;if(t.sendWithFormData)O.logger.debugLog(`uploady.sender: sending ${e.length} item(s) as form data`),n=L(e,t);else{if(e.length>1)throw new Error("XHR Sender - Request without form data can only contain 1 item. received "+e.length);const t=e[0];O.logger.debugLog(`uploady.sender: sending item ${t.id} as request body`),n=t.file||t.url}return n})(e,n),i=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,u=arguments.length>2?arguments[2]:void 0;u=Object(O.merge)({...Object(O.pick)(n,["method","headers","withCredentials"]),preSend:t=>{t.upload.onprogress=t=>{t.lengthComputable&&r&&r(t,e.slice())}}},u);const d=Object(O.request)(o,i,u);return a=d.xhr,d},u=null!=o&&o.preRequestHandler?o.preRequestHandler(i,e,t,n,r,o):i();return{url:t,count:e.length,pXhr:u,getXhr:()=>a,aborted:!1}},C=(e,t,n)=>{let r=e;const o=null==t?void 0:t["content-type"];if(n.forceJsonResponse||null!=o&&o.includes("json"))try{r=JSON.parse(e)}catch{}return r},w=(e,t)=>e.pXhr.then(e=>{var n,r;let o,a,s;O.logger.debugLog("uploady.sender: received upload response ",e),o=~R.indexOf(e.status)?O.FILE_STATES.FINISHED:O.FILE_STATES.ERROR,s=e.status;const i=Object(O.parseResponseHeaders)(e);return a={data:null!==(n=null===(r=t.formatServerResponse)||void 0===r?void 0:r.call(t,e.response,s,i))&&void 0!==n?n:C(e.response,i,t),headers:i},{status:s,state:o,response:a}}).catch(t=>{let n,r;return e.aborted?(n=O.FILE_STATES.ABORTED,r="aborted"):(O.logger.debugLog("uploady.sender: upload failed: ",t),n=O.FILE_STATES.ERROR,r=t),{error:!0,state:n,response:r,status:0}});var P=e=>(t,n,r,o)=>{if(!n)throw new A(y);O.logger.debugLog("uploady.sender: sending file: ",{items:t,url:n,options:r});const a=_(t,n,r,o,e);return{request:w(a,r),abort:()=>(e=>{let t=!1;const{aborted:n,getXhr:r}=e,o=r();return!n&&o&&o.readyState&&4!==o.readyState&&(O.logger.debugLog(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),o.abort(),e.aborted=!0,t=!0),t})(a),senderType:y}};const D=P();var U=D;const j=Object(O.devFreeze)({chunked:!0,chunkSize:5242880,retries:0,parallel:1});let k=null;const B=(k=null,Object(O.hasWindow)()&&"Blob"in window&&(k=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),!!k),F=(e,t,n)=>{var r;const o=null===(r=k)||void 0===r?void 0:r.call(e,t,n,e.type);return o&&(o.name=e.name,o.lastModified=e.lastModified),o};class N extends Error{constructor(e){super(e),this.name="ChunkedSendError"}}var H=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const{chunkSize:r}=t,o=n?e.file.size-n:e.file.size;if(o<=0)throw new N(`start byte ${n} is invalid. File size: ${e.file.size}`);const a=o<=r?1:Math.ceil(o/r);return new Array(a).fill(null).map((t,o)=>{const a=r*o+(n||0);return{id:`${e.id}_chunk-${o}`,start:a,end:Math.min(a+r,e.file.size),data:null,attempt:0,uploaded:0,index:o}})};const x=Symbol.for("__rpldy-sstt-proxy__"),q=Symbol.for("__rpldy-sstt-state__"),M=e=>!Object(O.isProduction)()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(x),$=e=>Array.isArray(e)||Object(O.isPlainObject)(e)&&!(e=>Object(O.hasWindow)()&&e instanceof File||e.name&&e.size&&e.uri)(e),z=Object(O.getMerge)({withSymbols:!0,predicate:e=>e!==x&&e!==q}),G=e=>!!Object(O.isProduction)()||e[q].isUpdateable,W=(e,t)=>{Object(O.isProduction)()||(e[q].isUpdateable=t)},V=(e,t)=>{let n;return $(e)&&(M(e)||(e[x]=!0,n=new Proxy(e,t)),Object.keys(e).forEach(n=>{e[n]=V(e[n],t)})),n||e},K=e=>M(e)?Object(O.clone)(e,z):e;var X=e=>{const t={set:(e,r,o)=>(G(n)&&(e[r]=V(o,t)),!0),get:(e,t)=>t===x?K(e):e[t],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(e,t)=>(G(n)&&delete e[t],!0)};Object(O.isProduction)()||M(e)||Object.defineProperty(e,q,{value:{isUpdateable:!1},configurable:!0});const n=Object(O.isProduction)()?e:V(e,t);return{state:n,update:e=>{if(!Object(O.isProduction)()&&G(n))throw new Error("Can't call update on State already being updated!");try{W(n,!0),e(n)}finally{W(n,!1)}return n},unwrap:e=>e?K(e):M(n)?K(n):n}};const Y=Object(O.devFreeze)({CHUNK_START:"CHUNK_START",CHUNK_FINISH:"CHUNK_FINISH"}),Q="rpldy-chunked-sender";var Z=(e,t,n,r,o,a)=>(e.requests[n]={id:n,abort:r.abort},r.request.then(r=>{O.logger.debugLog(`chunkedSender: request finished for chunk: ${n} - `,r),delete e.requests[n];const s=e.chunks.findIndex(e=>e.id===n);if(~s){if(r.state===O.FILE_STATES.FINISHED){const n=e.chunks.splice(s,1)[0],i=n.end-n.start;a({loaded:i,total:t.file.size},[n]),o(Y.CHUNK_FINISH,{chunk:Object(O.pick)(n,["id","start","end","index","attempt"]),item:K(t),uploadData:r})}else r.state!==O.FILE_STATES.ABORTED&&(e.chunks[s].attempt+=1);e.responses.push(r.response)}}));var J=e=>{const t=[],n=Object.keys(e.requests),r=e.parallel||1;for(let o=0;o<e.chunks.length&&n.length<r&&t.length<r;o++){const r=e.chunks[o];if(!n.includes(r.id)){if(r.attempt&&!(r.attempt<e.retries))throw new N("chunk failure");t.push(r)}}return t};const ee=(e,t,n)=>t&&`bytes ${e.start}-${e.start+t.size-1}/${n.file.size}`,te=Object(O.getMerge)({undefinedOverwrites:!0}),ne=(e,t,n,r,o)=>{const a={...K(t.sendOptions),headers:{...t.sendOptions.headers,"Content-Range":ee(e,e.data,n)}},s=Object(O.createBatchItem)(e.data,e.id),i=t=>{r(t,[e])},u=t.chunks.indexOf(e);return Object(O.triggerUpdater)(o,Y.CHUNK_START,{item:K(n),chunk:Object(O.pick)(e,["id","start","end","index","attempt"]),chunkItem:s,sendOptions:a,url:t.url,chunkIndex:u,remainingCount:t.chunks.length,totalCount:t.chunkCount,onProgress:r}).then(e=>{const r=!1===e;return r&&O.logger.debugLog(`chunkedSender.sendChunk: received false from CHUNK_START handler - skipping chunk ${u}, item ${n.id}`),r?{request:Promise.resolve({state:O.FILE_STATES.FINISHED,response:"skipping chunk as instructed by CHUNK_START handler",status:200}),abort:()=>!0,senderType:"chunk-skipped-sender"}:U([s],(null==e?void 0:e.url)||t.url,te({},a,e&&e.sendOptions),i)})};var re=(e,t,n,r,o)=>{if(e.data||(e.data=F(n.file,e.start,e.end)),!e.data)throw new N("chunk failure - failed to slice");O.logger.debugLog(`chunkedSender.sendChunk: about to send chunk ${e.id} [${e.start}-${e.end}] to: ${t.url||""}`);const a=ne(e,t,n,r,o);return{request:a.then(e=>{let{request:t}=e;return t}),abort:()=>(a.then(e=>{let{abort:t}=e;return t()}),!0),senderType:"chunk-passthrough-sender"}};const oe=(e,t)=>{e(t instanceof N?{state:O.FILE_STATES.ERROR,response:"At least one chunk failed"}:{state:O.FILE_STATES.ERROR,response:t.message})},ae=(e,t,n,r)=>{e.finished=!0,n({state:r,response:{results:e.responses}})},se=(e,t,n,r,o,a)=>new Promise((s,i)=>{try{const i=re(o,e,t,n,a);Z(e,t,o.id,i,a,n).then(()=>{s(),((e,t,n)=>{const r=!e.chunks.length;return e.aborted?(O.logger.debugLog("chunkedSender: chunked upload aborted for item: "+t.id),ae(e,0,n,O.FILE_STATES.ABORTED)):r&&!e.error&&(O.logger.debugLog("chunkedSender: chunked upload finished for item: "+t.id,e.responses),ae(e,0,n,O.FILE_STATES.FINISHED)),r||e.error})(e,t,r)||ie(e,t,n,r,a)})}catch(e){i(e)}}),ie=(e,t,n,r,o)=>{if(!e.finished&&!e.aborted){const a=Object.keys(e.requests).length;if(!a||e.parallel&&e.parallel>a){let a;try{a=J(e)}catch(e){oe(r,e)}a&&a.forEach(a=>{se(e,t,n,r,a,o).catch(t=>{e.error=!0,oe(r,t)})})}}};var ue=ie;var de=(e,t,n,r)=>{e.uploaded[n]=Math.max(r,e.uploaded[n]||0);const o=Object.keys(e.uploaded).reduce((t,n)=>t+e.uploaded[n],e.startByte),a=t.file.size;return{loaded:Math.min(o,a),total:a}};const ce=(e,t,n,r)=>{const o=(r,o)=>{const a=de(e,t,o[0].id,r.loaded);n(a,[t])};return{sendPromise:new Promise(n=>{ue(e,t,o,n,r)}),abort:()=>((e,t)=>(O.logger.debugLog("chunkedSender: aborting chunked upload for item: "+t.id),e.finished||e.aborted||(Object.keys(e.requests).forEach(t=>{O.logger.debugLog("chunkedSender: aborting chunk: "+t),e.requests[t].abort()}),e.aborted=!0),e.aborted))(e,t)}};var le=(e,t,n,r,o,a)=>{const s=H(e,t,r.startByte);O.logger.debugLog(`chunkedSender: created ${s.length} chunks for: ${e.file.name}`);const i={finished:!1,aborted:!1,error:!1,uploaded:{},requests:{},responses:[],chunkCount:s.length,startByte:r.startByte||0,chunks:s,url:n,sendOptions:r,...t},{sendPromise:u,abort:d}=ce(i,e,o,a);return{request:u,abort:d,senderType:Q}};var fe=(e,t)=>{const n=(e=>Object(O.merge)({},j,e))(e);return{send:(e,r,o,a)=>{let s;return!n.chunked||e.length>1||e[0].url||!e[0].file.size?(s=U(e,r,o,a),O.logger.debugLog("chunkedSender: sending items as normal, un-chunked requests")):(O.logger.debugLog("chunkedSender: sending file as a chunked request"),s=le(e[0],n,r,o,a,t)),s}}};var pe=e=>(t,n)=>{const r=fe(e,n);return O.logger.debugLog("chunkedSenderEnhancer: Created chunked-sender instance with options: ",e),t.update({send:r.send}),t},ge=pe;var he=Object(O.devFreeze)({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1});const be=(e,t)=>{if(!Object(O.isFunction)(e))throw new Error(`'${t}' is not a valid function`)},me=e=>void 0===e,Se=Symbol.for("__le__"),Ee=Symbol.for("__le__pack__"),ve=e=>e?e[Se]:null,Te=e=>{const t=ve(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},Oe=e=>!!ve(e),ye=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];be(n,"cb");const o=Te(e);if(!o.options.allowRegisterNonExistent&&!~o.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);const a=o.registry[t]||[];return a.find(e=>e.cb===n)||(a.push({name:t,cb:n,once:r}),o.registry[t]=a),()=>Pe.call(e,t,n)},Ae=(e,t)=>{const n=Te(e).registry;return t?n[t]?n[t].slice():[]:Object.values(n).flat()},Ie={on:function(e,t){return ye(this,e,t)},once:function(e,t){return ye(this,e,t,!0)},off:Pe,getEvents:function(){return Te(this).events.slice()}},Le=()=>Object.entries(Ie).reduce((e,t)=>{let[n,r]=t;return e[n]={value:r},e},{}),Re={trigger:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const o=Ae(this,e);let a;if(o.length){var s;let t;1===n.length&&!0===(null===(s=n[0])||void 0===s?void 0:s[Ee])&&(t=n[0].resolve()),a=o.map(r=>{let o;return r.once&&we(this,e,r.cb),o=t?r.cb(...t):n.length?1===n.length?r.cb(n[0]):2===n.length?r.cb(n[0],n[1]):3===n.length?r.cb(n[0],n[1],n[2]):r.cb(...n):r.cb(),o}).filter(e=>!me(e)).map(e=>Object(O.isPromise)(e)?e:Promise.resolve(e))}return a&&(a.length?a:void 0)},addEvent:function(e){const t=Te(this);if(!t.options.canAddEvents)throw new Error("Cannot add new events (canAddEvents = false)");if(~t.events.indexOf(e))throw new Error(`Event '${e}' already defined`);t.events.push(e)},removeEvent:function(e){const t=Te(this);if(!t.options.canRemoveEvents)throw new Error("Cannot remove events (canRemoveEvents = false)");{const n=t.events.indexOf(e);t.events.splice(n,1)}},hasEvent:function(e){return!!~Te(this).events.indexOf(e)},hasEventRegistrations:function(e){return!!Ae(this,e).length},assign:function(e){const t=Te(this);return De(e,t.options,t.events,t.registry,t.stats),_e(e)}},_e=e=>Object.keys(Re).reduce((t,n)=>(t[n]=Re[n].bind(e),t),{target:e,...Re}),Ce=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Te(e).registry;!r[t]||!n&&r[t].length||delete r[t]},we=(e,t,n)=>{const r=Te(e).registry;r[t]&&(n?(r[t]=r[t].filter(e=>e.cb!==n),Ce(e,t)):Ce(e,t,!0))};function Pe(e,t){we(this,e,t)}const De=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};Object.defineProperties(e,{[Se]:{value:Object.seal({registry:r,events:n,options:t,stats:o})},...Le()})};var Ue=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return e=e||{},n={...he,...n},Oe(e)||De(e,n,t),_e(e)};var je=e=>{const t={resolve:()=>[].concat(e())};return Object.defineProperty(t,Ee,{value:!0,configurable:!1}),t};const ke="rpldy-mock-sender",Be=Object(O.devFreeze)({delay:500,fileSize:1e6,progressIntervals:[10,25,50,75,99]}),Fe=(e,t,n)=>e.then(e=>{var r;let{items:o,...a}=e;O.logger.debugLog("uploady.mockSender: mock request finished successfully",o);const s={sendOptions:n,mock:!0,success:!0},i={"x-request-type":"react-uploady.mockSender"},u=t.responseStatus||200;return{status:u,state:O.FILE_STATES.FINISHED,response:{...a,headers:i,data:t.response||(null===(r=n.formatServerResponse)||void 0===r?void 0:r.call(n,JSON.stringify(s),u,i))||s}}}).catch(e=>(O.logger.debugLog("uploady.mockSender: mock request was aborted",e),{status:0,state:O.FILE_STATES.ABORTED,response:"abort"}));var Ne=e=>{let t={...Be,...e};return{send:(e,n,r,o)=>{O.logger.debugLog("uploady.mockSender: about to make a mock request for items: ",e);const a=((e,t)=>{const n=performance.now(),r=[];let o=!1,a=!1,s=null,i=null,u=null;const d=()=>{i&&(i.forEach(e=>{clearTimeout(e)}),i=null)},c=new Promise((o,s)=>{u=s,setTimeout(()=>{a=!0,o({options:e,time:performance.now()-n,progressEvents:r,items:t}),d()},e.delay||0)});return e.progressIntervals&&(i=e.progressIntervals.map(n=>{const i=n/100,u=(e.delay||0)*i;return setTimeout(()=>{if(!o&&!a&&s){const n={total:e.fileSize||0,loaded:(e.fileSize||0)*i};r.push(n),s(n,t)}},u)})),{then:c.then.bind(c),abort:()=>(o=!0,a=!0,u&&u(),d(),!0),onProgress:e=>{s=e}}})(t,e);return a.onProgress(o),{request:Fe(a,t,r),abort:a.abort,senderType:ke}},update:e=>{t={...t,...e}}}};var He=e=>t=>{const n=Ne(e);return t.update({send:n.send}),t},xe=Ne;const qe=Object(O.devFreeze)({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",BATCH_ERROR:"BATCH-ERROR",BATCH_FINALIZE:"BATCH-FINALIZE",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),Me=Object(O.devFreeze)({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),$e=[O.FILE_STATES.FINISHED,O.FILE_STATES.ERROR,O.FILE_STATES.CANCELLED,O.FILE_STATES.ABORTED],ze=Object(O.getMerge)({undefinedOverwrites:!0}),Ge=(e,t,n,r,o,a)=>Object(O.triggerUpdater)(e.trigger,o,t,r).then(e=>(null==a||a(e),((e,t,n,r)=>{if(r){if(O.logger.debugLog(`uploader.queue: REQUEST_PRE_SEND(${e}) event returned updated items/options`,r),r.items){if(r.items.length!==t.length||!Object(O.isSamePropInArrays)(r.items,t,["id","batchId","recycled"]))throw new Error(`REQUEST_PRE_SEND(${e}) event handlers must return same items with same ids`);t=r.items}r.options&&(n=ze({},n,r.options))}return{items:t,options:n,cancelled:!1===r}})(o,n,r,e))),We=(e,t,n,r,o,a)=>{const s=n(t),i=e.getState().batches[s[0].batchId].batchOptions,u=(null==r?void 0:r(t,i))||t;return Ge(e,u,s,i,a,o).then(t=>(t.cancelled||((e,t)=>{e.updateState(e=>{t.items.forEach(t=>{e.items[t.id]=t}),e.batches[t.items[0].batchId].batchOptions=t.options});const n=e.getState();t.items=t.items.map(e=>n.items[e.id]),t.options=n.batches[t.items[0].batchId].batchOptions})(e,t),t))},Ve=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(o,a)=>We(o,a,t,n,r,e)},Ke=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.getState(),o=r.itemQueue.indexOf(t);~o&&e.updateState(e=>{n&&delete e.items[t],e.itemQueue.splice(o,1);const r=e.activeIds.indexOf(t);~r&&e.activeIds.splice(r,1)})},Xe=(e,t,n)=>e.getState().items[t].batchId===n,Ye=Ve(qe.BATCH_START,e=>e.items,null,(function(){let{batch:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e)throw new Error("BATCH_START event handlers cannot update batch data. Only items & options")})),Qe=[O.BATCH_STATES.ADDED,O.BATCH_STATES.PROCESSING,O.BATCH_STATES.UPLOADING],Ze=[O.BATCH_STATES.ABORTED,O.BATCH_STATES.CANCELLED,O.BATCH_STATES.FINISHED,O.BATCH_STATES.ERROR],Je=(e,t)=>e.batches[t].batch,et=(e,t)=>{const n=e.getState(),r=n.items[t];return n.batches[r.batchId]},tt=(e,t)=>et(e,t).batch,nt=(e,t)=>{((e,t)=>Je(e.getState(),t))(e,t).items.forEach(t=>{let{id:n}=t;return Ke(e,n,!0)})},rt=(e,t)=>{e.updateState(e=>{delete e.batches[t]})},ot=(e,t,n)=>{at(e,t,n),at(e,t,qe.BATCH_FINALIZE)},at=(e,t,n)=>{const r=e.getState(),o=Je(r,t),a=r.items,s={...K(o),items:o.items.map(e=>{let{id:t}=e;return K(a[t])})};e.trigger(n,s)},st=(e,t)=>{const n=tt(e,t);return Qe.includes(n.state)},it=e=>Ze.includes(e.state),ut={[O.FILE_STATES.PENDING]:null,[O.FILE_STATES.ADDED]:qe.ITEM_START,[O.FILE_STATES.FINISHED]:qe.ITEM_FINISH,[O.FILE_STATES.ERROR]:qe.ITEM_ERROR,[O.FILE_STATES.CANCELLED]:qe.ITEM_CANCEL,[O.FILE_STATES.ABORTED]:qe.ITEM_ABORT,[O.FILE_STATES.UPLOADING]:qe.ITEM_PROGRESS},dt=e=>!!~$e.indexOf(e.state);var ct=(e,t,n)=>{t.forEach(t=>{const n=e.getState(),{id:r,info:o}=t;if(O.logger.debugLog("uploader.processor.queue: request finished for item - ",{id:r,info:o}),n.items[r]){e.updateState(e=>{const t=e.items[r];t.state=o.state,t.uploadResponse=o.response,t.uploadStatus=o.status,dt(t)&&delete e.aborts[r]});const t=e.getState().items[r];o.state===O.FILE_STATES.FINISHED&&t.completed<100&&e.handleItemProgress(t,100,t.file?t.file.size:0),ut[t.state]&&e.trigger(ut[t.state],t),dt(t)&&(((e,t)=>{e.updateState(e=>{e.batches[t].finishedCounter+=1})})(e,t.batchId),e.trigger(qe.ITEM_FINALIZE,t))}Ke(e,r)}),(e=>{const t=e.getState();Object.keys(t.batches).forEach(n=>{const{batch:r,finishedCounter:o}=t.batches[n],{orgItemCount:a}=r,s=it(r);a===o&&(s||100===r.completed||(e.updateState(e=>{const t=Je(e,n);t.completed=100,t.loaded=t.items.reduce((e,t)=>{let{loaded:n}=t;return e+n},0)}),at(e,n,qe.BATCH_PROGRESS)),e.updateState(e=>{const t=Je(e,n);t.state=s?t.state:O.BATCH_STATES.FINISHED,e.currentBatch===n&&(e.currentBatch=null)}),O.logger.debugLog("uploady.uploader.batchHelpers: cleaning up batch: "+r.id),s||ot(e,n,qe.BATCH_FINISH),nt(e,n),rt(e,n))})})(e),n(e)};const lt=Ve(qe.REQUEST_PRE_SEND,e=>e,(e,t)=>({items:e,options:t})),ft=(e,t,n)=>{const{items:r,options:o}=t,a=e.getState().batches[r[0].batchId].batch;let s;try{s=e.sender.send(r,a,o)}catch(e){O.logger.debugLog("uploader.queue: sender failed with unexpected error",e),s={request:Promise.resolve({status:0,state:O.FILE_STATES.ERROR,response:e.message}),abort:()=>!1,senderType:"exception-handler"}}const{request:i}=s;return((e,t,n)=>{e.updateState(e=>{t.forEach(t=>{e.items[t.id].state=O.FILE_STATES.UPLOADING,e.aborts[t.id]=n.abort})})})(e,r,s),i.then(t=>{const o=r.map(e=>({id:e.id,info:t}));ct(e,o,n)})},pt=e=>{let{allowedItems:t,cancelledResults:n,queue:r,items:o,ids:a,next:s}=e;return(t.length?lt(r,t):Promise.resolve()).catch(e=>{O.logger.debugLog("uploader.queue: encountered error while preparing items for request",e),((e,t,n,r)=>{const o=n.map(t=>{let{id:n}=t;return{id:n,info:{status:0,state:O.FILE_STATES.ERROR,response:e}}});ct(t,o,r)})(e,r,o,s)}).then(e=>{let t;return e&&(e.cancelled?n=a.map(()=>!0):ft(r,{items:e.items,options:e.options},s)),((e,t,n,r)=>{const o=n.map((e,n)=>e?t[n].id:null).filter(Boolean);if(o.length){const t=o.map(e=>({id:e,info:{status:0,state:O.FILE_STATES.CANCELLED,response:"cancel"}}));ct(e,t,r)}return!!o.length})(r,o,n,s)||(t=s(r)),t})};var gt=(e,t,n)=>{const r=e.getState();let o=Object.values(r.items);return o=o.filter(e=>!!~t.indexOf(e.id)),Promise.all(o.map(t=>e.runCancellable(qe.ITEM_START,t))).then(r=>({allowedItems:r.map((t,n)=>t?null:((e,t)=>{const n=t.getState().items[e];return n&&!$e.includes(n.state)?n:void 0})(o[n].id,e)).filter(Boolean),cancelledResults:r,queue:e,items:o,ids:t,next:n})).then(pt)};const ht=(e,t)=>e.getState().activeIds.flat().includes(t),bt=e=>{const t=e.getState().itemQueue,n=(e=>{const t=e.getState(),n=t.itemQueue,r=t.items;let o=0,a=n[o];for(;a&&(ht(e,a)||!st(e,a)||r[a].state!==O.FILE_STATES.ADDED);)o+=1,a=n[o];return a?o:-1})(e);let r,o=t[n];if(o){const a=et(e,o),s=a.batch.id,i=a.batchOptions.maxGroupSize||0;if(a.batchOptions.grouped&&i>1){r=[];let a=!0;for(;r.length<i&&a;)r.push(o),o=t[n+r.length],a=o&&Xe(e,o,s)}else r=[o]}return r},mt=(e,t)=>{let n;return((e,t)=>{e.updateState(e=>{e.activeIds=e.activeIds.concat(t)})})(e,t),n=((e,t)=>{const n=tt(e,t);return e.getState().currentBatch!==n.id})(e,t[0])?((e,t)=>{const n=tt(e,t);return Ye(e,n).then(t=>{let{cancelled:r}=t;return r||e.updateState(e=>{e.currentBatch=n.id}),!r})})(e,t[0]).then(n=>{let r=!n;return r&&(((e,t)=>{const n=tt(e,t),r=n.id;O.logger.debugLog("uploady.uploader.batchHelpers: cancelling batch: ",{batch:n}),e.updateState(e=>{Je(e,r).state=O.BATCH_STATES.CANCELLED}),ot(e,r,qe.BATCH_CANCEL),nt(e,r),rt(e,r)})(e,t[0]),St(e)),r}).catch(n=>(O.logger.debugLog("uploader.processor: encountered error while preparing batch for request",n),((e,t,n)=>{const r=tt(e,t),o=r.id;O.logger.debugLog("uploady.uploader.batchHelpers: failing batch: ",{batch:r}),e.updateState(e=>{const t=Je(e,o);t.state=O.BATCH_STATES.ERROR,t.additionalInfo=n.message}),ot(e,o,qe.BATCH_ERROR),nt(e,o),rt(e,o)})(e,t[0],n),St(e),!0)):Promise.resolve(!1),n},St=e=>{let t;const n=bt(e);if(n){const r=e.getCurrentActiveCount(),{concurrent:o=0,maxConcurrent:a=0}=e.getOptions();(!r||o&&r<a)&&(O.logger.debugLog("uploader.processor: Processing next upload - ",{ids:n,currentCount:r}),t=mt(e,n).then(t=>{t||(gt(e,n,St),o&&St(e))}))}return t};var Et=St;const vt=(e,t,n)=>(O.logger.debugLog(`uploader.queue: aborting ${t.state} item  - `,t),ct(e,[{id:t.id,info:{status:0,state:O.FILE_STATES.ABORTED,response:"aborted"}}],n),!0),Tt={[O.FILE_STATES.UPLOADING]:(e,t)=>(O.logger.debugLog("uploader.queue: aborting uploading item  - ",t),e.getState().aborts[t.id]()),[O.FILE_STATES.ADDED]:vt,[O.FILE_STATES.PENDING]:vt},Ot=(e,t,n)=>{const r=e.getState().items[t],o=null==r?void 0:r.state;return!!Tt[o]&&Tt[o](e,r,n)};var yt=(e,t,n,r,o)=>{const{state:a,update:s}=X({itemQueue:[],currentBatch:null,batches:{},items:{},activeIds:[],aborts:{}}),i=()=>a,u=e=>{s(e)},d=e=>{if(a.items[e.id]&&!e.recycled)throw new Error(`Uploader queue conflict - item ${e.id} already exists`);e.recycled&&((e,t)=>{const{previousBatch:n}=t;if(t.recycled&&n&&e.getState().batches[n]){const{id:r}=tt(e,t.id);r===n&&e.updateState(e=>{const n=Je(e,r),o=n.items.findIndex(e=>{let{id:n}=e;return n===t.id});~o&&n.items.splice(o,1)})}})(l,e),u(t=>{t.items[e.id]=e,t.itemQueue.push(e.id)})},c=(e,n,r)=>{a.items[e.id]&&(u(t=>{const o=t.items[e.id];o.loaded=r,o.completed=n}),t(qe.ITEM_PROGRESS,i().items[e.id]))};r.on(Me.ITEM_PROGRESS,c),r.on(Me.BATCH_PROGRESS,e=>{var n;const r=null===(n=a.batches[e.id])||void 0===n?void 0:n.batch.items;if(r){const[n,o]=r.reduce((e,t)=>{let{id:n}=t;const{completed:r,loaded:o}=a.items[n];return e[0]+=r,e[1]+=o,e},[0,0]);u(t=>{const a=t.batches[e.id].batch;a.completed=n/r.length,a.loaded=o}),t(qe.BATCH_PROGRESS,a.batches[e.id].batch)}});const l={uploaderId:o,getOptions:()=>e,getCurrentActiveCount:()=>a.activeIds.length,getState:i,updateState:u,trigger:t,runCancellable:function(e){if(!Object(O.isFunction)(n))throw new Error("Uploader queue - cancellable is of wrong type");for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return n(e,...r)},sender:r,handleItemProgress:c};return Object(O.hasWindow)()&&O.logger.isDebugOn()&&(window[`__rpldy_${o}_queue_state`]=l),{updateState:u,getState:l.getState,runCancellable:l.runCancellable,uploadBatch:(e,t)=>{t&&u(n=>{n.batches[e.id].batchOptions=t}),Et(l)},addBatch:(e,t)=>(u(n=>{n.batches[e.id]={batch:e,batchOptions:t,finishedCounter:0}}),e.items.forEach(d),Je(a,e.id)),abortItem:e=>((e,t,n)=>Ot(e,t,n))(l,e,Et),abortBatch:e=>{((e,t,n)=>{const r=e.getState().batches[t],o=null==r?void 0:r.batch;o&&!it(o)&&(e.updateState(e=>{Je(e,t).state=O.BATCH_STATES.ABORTED}),at(e,t,qe.BATCH_ABORT),o.items.forEach(t=>Ot(e,t.id,n)))})(l,e,Et)},abortAll:()=>{((e,t)=>{const n=e.getState().items;Object.keys(n).forEach(n=>Ot(e,n,t)),e.trigger(qe.ALL_ABORT)})(l,Et)},clearPendingBatches:()=>{(e=>{const t=e.getState().batches;Object.keys(t).filter(e=>t[e].batch.state===O.BATCH_STATES.PENDING).forEach(t=>{nt(e,t),rt(e,t)})})(l)},uploadPendingBatches:e=>{((e,t)=>{e.updateState(e=>{Object.keys(e.batches).forEach(n=>{const r=e.batches[n],{batch:o,batchOptions:a}=r;o.state===O.BATCH_STATES.PENDING&&(o.items.forEach(e=>{e.state=O.FILE_STATES.ADDED}),o.state=O.BATCH_STATES.ADDED,r.batchOptions=Object(O.merge)({},a,t))})})})(l,e),Et(l)}}};const At=()=>!0,It=Object(O.devFreeze)({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:At,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0,formDataAllowUndefined:!1}),Lt=(e,t,n,r)=>{((e,t,n,r)=>{e.forEach(e=>{O.logger.debugLog(`uploady.uploader.processor: file: ${e.id} progress event: loaded(${n}) - completed(${t})`),r(Me.ITEM_PROGRESS,e,t,n)})})(e,Math.min(n.loaded/n.total*100,100)/e.length,n.loaded/e.length,r),r(Me.BATCH_PROGRESS,t)};var Rt=()=>{const{trigger:e,target:t}=Ue({send:(t,n,r)=>{const o=r.destination,a=null==o?void 0:o.url,s=Object(O.throttle)(r=>Lt(t,n,r,e),50,!0);return(Object(O.isFunction)(r.send)?r.send:U)(t,a,{method:(null==o?void 0:o.method)||r.method||It.method,paramName:(null==o?void 0:o.filesParamName)||r.inputFieldName||"file",params:{...r.params,...null==o?void 0:o.params},forceJsonResponse:r.forceJsonResponse,withCredentials:r.withCredentials,formatGroupParamName:r.formatGroupParamName,headers:null==o?void 0:o.headers,sendWithFormData:r.sendWithFormData,formatServerResponse:r.formatServerResponse,formDataAllowUndefined:r.formDataAllowUndefined},s)}},Object.values(Me));return t};const _t=Object(O.hasWindow)()&&"FileList"in window,Ct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e;return Object(O.isProduction)()||(t<3&&M(e)?n=K(e):t<3&&$(e)&&(n=Array.isArray(e)?e.map(e=>Ct(e,t+1)):Object.keys(e).reduce((n,r)=>(n[r]=Ct(e[r],t+1),n),{}))),n};let wt=0;var Pt=(e,t,n)=>{wt+=1;const r="batch-"+wt,o=(e=>_t&&e instanceof FileList||"[object FileList]"===e.toString())(e);e=Array.isArray(e)||o?e:[e];const a=!n.autoUpload;return((e,t,n,r)=>Promise.all(Array.prototype.map.call(t,e=>{const t=(r||At)(e);return Object(O.isPromise)(t)?t.then(t=>!!t&&e):!!t&&e})).then(t=>t.filter(Boolean).map(t=>Object(O.createBatchItem)(t,e,n))))(r,e,a,n.fileFilter).then(e=>({id:r,uploaderId:t,items:e,state:a?O.BATCH_STATES.PENDING:O.BATCH_STATES.ADDED,completed:0,loaded:0,orgItemCount:e.length,additionalInfo:null}))};var Dt=(e,t,n,r)=>{const o=Rt(),a=yt(n,e,t,o,r);return{process:(e,t)=>{a.uploadBatch(e,t)},abortBatch:e=>{a.abortBatch(e)},abort:e=>{e?a.abortItem(e):a.abortAll()},addNewBatch:(e,t,n)=>Pt(e,t,n).then(e=>a.addBatch(e,n)),runCancellable:a.runCancellable,clearPendingBatches:()=>{a.clearPendingBatches()},processPendingBatches:e=>{a.uploadPendingBatches(e)}}};const Ut=Object.values(qe);let jt=0;var kt=e=>{jt+=1;const t="uploader-"+jt;let n=!1;const r={};O.logger.debugLog(`uploady.uploader: creating new instance (${t})`,{options:e,counter:jt});let o=(e=>{return{...It,...e,destination:e&&e.destination?(t=e.destination,{params:{},...t}):null};var t})(e);const a=()=>{c.clearPendingBatches()};let{trigger:s,target:i}=Ue({id:t,update:e=>(o=Object(O.merge)({},o,e),i),add:(e,t)=>{const n=Object(O.merge)({},o,t);return n.clearPendingOnAdd&&a(),c.addNewBatch(e,i.id,n).then(e=>{let t;return e.items.length?t=c.runCancellable(qe.BATCH_ADD,e,n).then(t=>{t?(e.state=O.BATCH_STATES.CANCELLED,u(qe.BATCH_CANCEL,e)):(O.logger.debugLog(`uploady.uploader [${i.id}]: new items added - auto upload =\n                        ${String(n.autoUpload)}`,e.items),n.autoUpload&&c.process(e))}):O.logger.debugLog(`uploady.uploader: no items to add. batch ${e.id} is empty. check fileFilter if this isn't intended`),t})},upload:e=>{c.processPendingBatches(e)},abort:e=>{c.abort(e)},abortBatch:e=>{c.abortBatch(e)},getOptions:()=>Object(O.clone)(o),clearPending:a,registerExtension:(e,t)=>{Object(O.invariant)(n,"Uploady - uploader extensions can only be registered by enhancers"),Object(O.invariant)(!r[e],"Uploady - uploader extension by this name [%s] already exists",e),O.logger.debugLog("uploady.uploader: registering extension: "+e.toString(),t),r[e]=t},getExtension:e=>r[e]},Ut,{canAddEvents:!1,canRemoveEvents:!1});const u=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const o=je(()=>n.map(Ct));return s(e,o)},d=Object(O.triggerCancellable)(u);if(o.enhancer){n=!0;const e=o.enhancer(i,u);n=!1,i=e||i}const c=Dt(u,d,o,i.id);return Object(O.devFreeze)(i)};var Bt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.reduce((e,t)=>t(e,...r)||e,e)}},Ft=kt;const Nt=Symbol.for("__upldy-retry__"),Ht="RETRY_EVENT",xt=[O.FILE_STATES.ABORTED,O.FILE_STATES.ERROR],qt=(e,t,n,r,o)=>{const a=t.getState().failed,s=(r=r||Object.keys(a)).map(e=>a[e]).filter(Boolean);var i;s.length&&(o={...o||null,autoUpload:void 0===(null===(i=o)||void 0===i?void 0:i.autoUpload)||o.autoUpload},n(Ht,{items:s,options:o}),r.forEach(e=>((e,t)=>{e.updateState(e=>{const n=e.failed[t].batchId;delete e.failed[t];const r=e.batchIdsMap[n].indexOf(t);e.batchIdsMap[n].splice(r,1),e.batchIdsMap[n].length||delete e.batchIdsMap[n]})})(t,e)),e.add(s,o));return!!s.length},Mt=(e,t,n,r,o)=>{let a;return r?a=((e,t,n,r,o)=>(O.logger.debugLog("uploady.retry: about to retry item: "+r),qt(e,t,n,[r],o)))(e,t,n,r,o):(O.logger.debugLog("uploady.retry: about to retry all failed item"),a=qt(e,t,n,null,o)),a};var $t=(e,t)=>{const n=(()=>{const{state:e,update:t}=X({batchIdsMap:{},failed:{}});return{updateState:e=>{t(e)},getState:()=>e}})();return((e,t)=>{e.on(qe.ITEM_FINALIZE,e=>{~xt.indexOf(e.state)&&t.updateState(t=>{t.failed[e.id]=e;(t.batchIdsMap[e.batchId]=t.batchIdsMap[e.batchId]||[]).push(e.id)})})})(e,n),e.registerExtension(Nt,{retry:(r,o)=>Mt(e,n,t,r,o),retryBatch:(r,o)=>((e,t,n,r,o)=>{var a;O.logger.debugLog("uploady.retry: about to retry batch: "+r);const s=null===(a=t.getState().batchIdsMap[r])||void 0===a?void 0:a.slice();return!!s&&qt(e,t,n,s,o)})(e,n,t,r,o)}),e};var zt=e=>{let t=!1;(()=>{try{if(Object(O.hasWindow)()&&e in window){const n="__lsTest";window[e].setItem(n,"__test-"+Date.now()),window[e].removeItem(n),t=!0}}catch(e){}})();const n=["key","getItem","setItem","removeItem","clear"].reduce((n,r)=>(n[r]=function(){return t?window[e][r](...arguments):void 0},n),{});return n.isSupported=t,Object.defineProperty(n,"length",{get:()=>t?window[e].length:0}),n},Gt=zt("localStorage"),Wt=zt("sessionStorage");const Vt=Object(O.devFreeze)({...j,featureDetection:!1,featureDetectionUrl:null,version:"1.0.0",resume:!0,overrideMethod:!1,deferLength:!1,sendDataOnCreate:!1,storagePrefix:"__rpldy-tus__",lockedRetryDelay:2e3,forgetOnSuccess:!1,ignoreModifiedDateInStorage:!1}),Kt=(e,t,n)=>{const r=[e.file.name,e.file.type,e.file.size,t.ignoreModifiedDateInStorage?null:e.file.lastModified,n].filter(Boolean).join("/");return`${t.storagePrefix||Vt.storagePrefix}${r}`},Xt=(e,t,n,r)=>{n.resume&&Gt.setItem(Kt(e,n,r),JSON.stringify({time:Date.now(),uploadUrl:t}))},Yt=(e,t,n)=>{let r;const o=Kt(e,t,n);if(t.resume)try{const e=Gt.getItem(o);if(e){r=JSON.parse(e).uploadUrl}}catch(e){O.logger.debugLog("tusSender.resumableStore: failed to retrieve persisted data for key: "+o,e)}return r},Qt=(e,t,n)=>{const r=Kt(e,t,n);Gt.removeItem(r)},Zt=e=>{const t=e.storagePrefix||Vt.storagePrefix;for(let e=0;e<Gt.length;e++){const n=Gt.key(e);n&&!n.indexOf(t)&&Gt.removeItem(n)}},Jt=Symbol.for("__upldy-tus__"),en="rpldy-tus-sender",tn=[200,201,204],nn="creation-with-upload",rn="concatenation",on="creation-defer-length",an=e=>{const t=e.params&&Object.keys(e.params);return null!=t&&t.length?t.map(t=>`${t} ${btoa(e.params[t])}`).join(","):void 0},sn=(e,t)=>e.then(e=>(e.state===O.FILE_STATES.FINISHED&&(e.response.location=t),e)),un=(e,t,n,r,o)=>{const{options:a}=n.getState(),s=((e,t)=>{let n;return n=/^(http:|https:)?\/\//.test(t)?t:t.startsWith("/")?(e.startsWith("/")?"":new URL(e).origin.replace(/\/$/,""))+t:[e.replace(/\/$/,""),t.replace(/^\//,"")].join("/"),n})(t,r.getResponseHeader("Location"));let i=0,u=!1;if(O.logger.debugLog(`tusSender.create: successfully created upload for item: ${e.id} - upload url = ${s}`),a.sendDataOnCreate){const e=parseInt(r.getResponseHeader("Upload-Offset"));i=isNaN(e)?i:e,u=+a.parallel>1&&i===(null==o?void 0:o.size)}return n.updateState(t=>{t.items[e.id].uploadUrl=s,t.items[e.id].offset=i}),{offset:i,uploadUrl:s,isNew:!0,isDone:u}};var dn=(e,t,n,r,o)=>{const{options:a}=n.getState(),s={"tus-resumable":a.version,"Upload-Defer-Length":a.deferLength?1:void 0,"Upload-Length":a.deferLength?void 0:e.file.size,"Upload-Metadata":o?void 0:an(r),"Content-Type":a.sendDataOnCreate?"application/offset+octet-stream":void 0,...r.headers};let i=null;if(O.logger.debugLog(`tusSender.create - creating upload for ${e.id} at: ${t}`),a.sendDataOnCreate){const t=+a.chunkSize;O.logger.debugLog("tusSender.create - adding first chunk to create request",{chunkSize:t,actualSize:e.file.size}),i=t<e.file.size?F(e.file,0,t):e.file}const u=Object(O.request)(t,i,{method:"POST",headers:s});let d=!1;return{request:u.then(r=>{let o=null;return r&&~tn.indexOf(r.status)?o=un(e,t,n,r,i):O.logger.debugLog("tusSender.create: create upload failed for item: "+e.id,r),o}).catch(e=>(O.logger.debugLog("tusSender.create: create upload failed",e),null)).finally(()=>{d=!0}),abort:()=>(d||(O.logger.debugLog("tusSender.create: aborting create request for item: "+e.id),u.xhr.abort()),!d)}};const cn=(e,t,n)=>(Qt(e,t,n),{isNew:!1,canResume:!1}),ln=(e,t,n,r,o)=>{const{options:a}=n.getState();O.logger.debugLog(`tusSender.resume - resuming upload for ${e.id}${r?"-"+r:""} at: ${t}`);const s=Object(O.request)(t,null,{method:"HEAD",headers:{"tus-resumable":a.version}});let i=!1;return{request:s.then(s=>{let i;return s&&~tn.indexOf(s.status)?i=((e,t,n,r)=>{let o=!1,a=!1;O.logger.debugLog(`tusSender.resume - successfully initiated resume for item: ${e.id} - upload url = ${t}`);const s=parseInt(r.getResponseHeader("Upload-Offset"));if(!isNaN(s)){const i=parseInt(r.getResponseHeader("Upload-Length"));isNaN(i)&&!n.getState().options.deferLength||(a=s===i,o=!a,n.updateState(n=>{n.items[e.id].uploadUrl=t,n.items[e.id].offset=s}))}return{offset:s,uploadUrl:t,isNew:!1,isDone:a,canResume:o}})(e,t,n,s):423===(null==s?void 0:s.status)&&0===o?(O.logger.debugLog(`tusSender.resume: upload is locked for item: ${e.id}. Will retry in ${+a.lockedRetryDelay}`,s),i=((e,t,n,r,o)=>new Promise(a=>{setTimeout(()=>{ln(e,t,n,r,o).request.then(a)},n.getState().options.lockedRetryDelay)}))(e,t,n,r,1)):(O.logger.debugLog(`tusSender.resume: failed for item: ${e.id}${r?"-"+r:""}`,s),i=cn(e,a,r)),i}).catch(t=>(O.logger.debugLog("tusSender.resume: resume upload failed unexpectedly",t),cn(e,a,r))).finally(()=>{i=!0}),abort:()=>(i||(O.logger.debugLog("tusSender.resume: aborting resume request for item: "+e.id),s.xhr.abort()),!i)}};var fn=(e,t,n,r)=>ln(e,t,n,r,0);var pn=(e,t,n,r,o)=>o.then(o=>{let a=o;if(o.state===O.FILE_STATES.FINISHED){const{options:s,items:i}=n.getState(),u=i[e.id];if(u){const d=u.parallelChunks,c=d.filter(e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.uploadUrl}).map(e=>i[e].uploadUrl);if(c.length!==d.length)throw new Error(`tusSender: something went wrong. found ${c.length} upload urls for ${d.length} chunks`);const l={"tus-resumable":s.version,"Upload-Concat":"final;"+c.join(" "),"Upload-Metadata":an(r)};O.logger.debugLog("tusSender.finalizeParallel: sending finalizing request",{url:t,headers:l});const f=Object(O.request)(t,null,{method:"POST",headers:l});n.updateState(t=>{t.items[e.id].abort=()=>(f.xhr.abort(),!0)}),a=((e,t)=>e.catch(e=>(O.logger.debugLog("tusSender.finalizeParallel: finalize request failed unexpectedly!",e),e)).then(e=>{let n;const r=(null==e?void 0:e.status)||0,o=!!~tn.indexOf(r),a=o&&e&&"getResponseHeader"in e&&e.getResponseHeader("Location");return a?(O.logger.debugLog("tusSender.finalizeParallel: successfully finalized parallel upload",a),n=sn(Promise.resolve(t),a)):(O.logger.debugLog("tusSender.finalizeParallel: parallel upload finalize failed!",r),n={status:r,state:O.FILE_STATES.ERROR,response:{message:(null==e?void 0:e.response)||(o&&!a?"No valid location header for finalize request":"")}}),n}))(f,o)}}return a});const gn=(e,t,n,r,o,a,s,i,u)=>s.then(s=>{let d,c=!1;if(s?s.isDone?(O.logger.debugLog("tusSender.handler: resume found server has completed file for item: "+e[0].id,e[0]),d=sn(Promise.resolve({status:200,state:O.FILE_STATES.FINISHED,response:{message:"TUS server has file"}}),s.uploadUrl)):s.isNew||s.canResume?d=u?((e,t,n,r)=>{const o=e[0];return n.uploadUrl&&Xt(o,n.uploadUrl,t.getState().options,r),O.logger.debugLog("tusSender.handler: created upload for parallelized chunk: "+o.id),Promise.resolve({status:200,state:O.FILE_STATES.UPLOADING,response:"TUS server created upload for parallelized part"})})(e,o,s,u):((e,t,n,r,o,a,s)=>{const{options:i}=o.getState(),u=e[0];O.logger.debugLog(`tusSender.handler: init request finished. sending item ${u.id} as chunked`,s),s.isNew&&s.uploadUrl&&Xt(u,s.uploadUrl,i),(s.canResume||i.sendDataOnCreate&&s.offset)&&(n={...n,startByte:s.offset});const d=a.send(e,t,n,r);return o.updateState(e=>{e.items[u.id].abort=d.abort}),+i.parallel>1?pn(u,t,o,n,d.request):sn(d.request,s.uploadUrl)})(e,t,n,r,o,a,s):c=!0:c=i,c){O.logger.debugLog("tusSender.handler: resume init failed. Will try creating a new upload for item: "+e[0].id);const{request:s}=dn(e[0],t,o,n);d=gn(e,t,n,r,o,a,s)}return d||Promise.resolve({status:0,state:O.FILE_STATES.ERROR,response:"TUS initialize failed"})});var hn=gn;const bn=(e,t)=>{t.updateState(t=>{t.items[e.id]={id:e.id,uploadUrl:null,size:e.file.size,offset:0,parallelChunks:[]}})};var mn=function(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const{options:i}=o.getState(),u=+i.parallel>1&&!s,d=e[0],c=!u&&Yt(d,i,s);let l;bn(d,o),l=u?{request:Promise.resolve({isNew:!0}),abort:()=>!0}:c?fn(d,c,o,s):dn(d,t,o,n,s);const f=hn(e,t,n,r,o,a,l.request,!!c,s),p=()=>(O.logger.debugLog("tusSender.handler: abort called for item: "+d.id),l.abort(),l.request.then(e=>{if(e){O.logger.debugLog("tusSender.handler: aborting chunked upload for item:  "+d.id);const e=o.getState().items[d.id].abort;e&&e()}}),!0);return{request:f,abort:p}};const Sn=(e,t)=>`_prlChunk_${+e.chunkSize}_${t}`,En=e=>({...e,"Content-Range":void 0});var vn=(e,t,n)=>{B&&(e.on(qe.ITEM_FINALIZE,e=>{const{items:n,options:r}=t.getState(),o=n[e.id];if(o){O.logger.debugLog(`tusSender.handleEvents: item ${e.id} finalized (${e.state}). Removing from state`);const n=o.parallelChunks;t.updateState(t=>{n.length&&n.forEach(e=>{delete t.items[e]}),delete t.items[e.id]}),r.forgetOnSuccess&&(O.logger.debugLog("tusSender.handleEvents: forgetOnSuccess enabled, removing item url from storage: "+e.id),Qt(e,r))}}),e.on(Y.CHUNK_START,e=>{const{options:r}=t.getState(),o=+r.parallel>1;return(o?((e,t,n)=>{const{item:r,chunkItem:o,url:a,sendOptions:s,onProgress:i,chunk:u}=n,{options:d}=e.getState();e.updateState(e=>{e.items[r.id].parallelChunks.push(o.id)});return mn([o],a,{...s,headers:En(s.headers),params:null},i,e,t,Sn(d,u.index)).request.then(e=>e.state!==O.FILE_STATES.FINISHED)})(t,n,e):Promise.resolve(!0)).then(n=>n&&((e,t,n)=>{const{item:r,chunk:o,chunkItem:a,remainingCount:s}=t,{options:i}=e.getState(),u=e.getState().items[n?a.id:r.id],d=n?0:u.offset||o.start,c=En({"tus-resumable":i.version,"Upload-Offset":d,"Content-Type":"application/offset+octet-stream","X-HTTP-Method-Override":i.overrideMethod?"PATCH":void 0,"Upload-Length":i.deferLength&&!s?r.file.size:void 0,"Upload-Concat":n?"partial":void 0});return O.logger.debugLog("tusSender.handleEvents: chunk start handler. offset = "+d,{headers:c,url:u.uploadUrl}),{sendOptions:{sendWithFormData:!1,method:i.overrideMethod?"POST":"PATCH",headers:c},url:u.uploadUrl}})(t,e,o))}),e.on(Y.CHUNK_FINISH,e=>{let{item:n,chunk:r,uploadData:o}=e;const{items:a,options:s}=t.getState();if(+s.parallel>1){if(s.forgetOnSuccess){const e=Sn(s,r.index);O.logger.debugLog("tusSender.handleEvents: forgetOnSuccess enabled, removing parallel chunk url from storage: "+e),Qt(n,s,e)}}else if(a[n.id]){const{status:e,response:a}=o;O.logger.debugLog(`tusSender.handleEvents: received upload response (code: ${e}) for : ${n.id}, chunk: ${r.id}`,a),~tn.indexOf(e)&&a.headers&&t.updateState(e=>{e.items[n.id].offset=a.headers["upload-offset"]})}}))};const Tn=e=>"rpldy_tus_fd_"+e,On={[rn]:(e,t)=>{+t.getState().options.parallel>1&&!~e.indexOf(rn)&&(O.logger.debugLog(`tusSender.featureDetection: disabling parallel uploads, ${rn} extension not available`),t.updateState(e=>{e.options.parallel=1}))},[nn]:(e,t)=>{t.getState().options.sendDataOnCreate&&!~e.indexOf(nn)&&(O.logger.debugLog(`tusSender.featureDetection: disabling create with data, ${nn} extension not available`),t.updateState(e=>{e.options.sendDataOnCreate=!1}))},[on]:(e,t)=>{t.getState().options.deferLength&&!~e.indexOf(on)&&(O.logger.debugLog(`tusSender.featureDetection: disabling defer length, ${on} extension not available`),t.updateState(e=>{e.options.deferLength=!1}))}},yn=(e,t,n)=>{const{options:r}=e.getState();if(t){O.logger.debugLog("tusSender.featureDetection: retrieved extensions from server",t);const n=t.split(",");if(n.length&&r.onFeaturesDetected){const t=r.onFeaturesDetected(n);t&&e.updateState(e=>{e.options=Object(O.merge)({},e.options,t)})}else Object.keys(On).forEach(t=>{On[t](n,e)})}n&&n!==e.getState().options.version&&(O.logger.debugLog("tusSender.featureDetection: setting version to server version: "+n),e.updateState(e=>{e.options.version=n})),e.updateState(e=>{e.featureDetection={processed:!0,version:n,extensions:t}})},An=(e,t,n)=>e.catch(e=>{O.logger.debugLog("tusSender.featureDetection: failed to retrieve data from server",e)}).then(e=>{if(e&&~tn.indexOf(e.status)){const r=e.getResponseHeader("Tus-Extension"),o=e.getResponseHeader("Tus-Resumable");r&&Wt.setItem(Tn(t),JSON.stringify({extensions:r,versions:o})),yn(n,r,o)}}),In=(e,t)=>{const{options:n}=t.getState(),r=Object(O.request)(e,null,{method:"OPTIONS",headers:{"tus-resumable":n.version}});return{request:An(r,e,t),abort:()=>(r.xhr.abort(),!0)}};var Ln=(e,t)=>{let n;const{options:r,featureDetection:o}=t.getState();e=r.featureDetectionUrl||e,O.logger.debugLog("tusSender.featureDetection: about to request server info",e);const a=Wt.getItem(Tn(e));return o.processed||(n=a?((e,t,n)=>{let r;try{var o;if(r=JSON.parse(n),null!==(o=r)&&void 0!==o&&o.extensions){const{extensions:e,version:n}=r;O.logger.debugLog("tusSender.featureDetection: retrieved feature detection data from session storage",r),yn(t,e,n)}else r=null}catch(e){O.logger.debugLog("tusSender.featureDetection: failed to load feature detection data from session storage")}return r||Wt.removeItem(Tn(e)),r?null:In(e,t)})(e,t,a):In(e,t)),n};var Rn=(e,t)=>B?(n,r,o,a)=>{let s;if(!r)throw new A(en);if(n.length>1||n[0].url)s=e.send(n,r,o,a);else{O.logger.debugLog("tusSender: sending file using TUS protocol");let i=t.getState().options.featureDetection?Ln(r,t):null;const{request:u,abort:d}=((e,t,n,r,o,a,s)=>{let i;const u=()=>{const s=mn(e,t,n,r,o,a);return i=s.abort,s.request};return{request:s?s.request.then(u,u):u(),abort:()=>i?i():(null==s?void 0:s.abort())||!1}})(n,r,o,a,t,e,i);s={request:u,abort:d,senderType:en}}return s}:U;const _n=e=>(((e=(e=>Object(O.merge)({},Vt,e))(e)).sendDataOnCreate||e.parallel)&&e.deferLength&&(O.logger.debugLog("tusSender: turning off deferLength - cannot be used when sendDataOnCreate or parallel is enabled"),e.deferLength=!1),e.chunked=!0,e);var Cn=(e,t,n)=>{t=_n(t);const r=fe(t,n),o=((e,t)=>{const{state:n,update:r}=X({options:t,items:{},featureDetection:{extensions:null,version:null,processed:!1}}),o={getState:()=>n,updateState:r};return Object(O.hasWindow)()&&O.logger.isDebugOn()&&(window[`__rpldy_${e.id}_tus_state`]=o),o})(e,t);vn(e,o,r);return{send:Rn(r,o),getOptions:()=>o.getState().options}};var wn=e=>(t,n)=>{const r=Cn(t,e,n);return t.update({send:r.send}),t.registerExtension(Jt,{getOptions:r.getOptions}),t},Pn=wn,Dn=n("EcSs"),Un=n.n(Dn),jn=n("cDcd"),kn=n.n(jn),Bn=n("Lrr1");const Fn=(e,t)=>{let n,r,o=!1;t?n=t:O.logger.debugLog("Uploady context - didn't receive input field ref - waiting for external ref");const a=()=>{var e;return null===(e=n)||void 0===e?void 0:e.current},s=()=>{const e=a();Object(O.invariant)(e,"Uploady - Context. File input isn't available"),e.removeEventListener("change",s);const t=r;r=null,i(e.files,t)},i=(t,n)=>{e.add(t,n)};return Object(Bn.d)(),{hasUploader:()=>!!e,getInternalFileInput:()=>(n&&(o=!0),n),setExternalFileInput:e=>{o=!0,n=e},getIsUsingExternalInput:()=>o,showFileUpload:e=>{const t=a();Object(O.invariant)(t,"Uploady - Context. File input isn't available"),r=e,t.removeEventListener("change",s),t.addEventListener("change",s),t.value="",t.click()},upload:i,processPending:t=>{e.upload(t)},clearPending:()=>{e.clearPending()},setOptions:t=>{e.update(t)},getOptions:()=>e.getOptions(),getExtension:t=>e.getExtension(t),abort:t=>{e.abort(t)},abortBatch:t=>{e.abortBatch(t)},on:(t,n)=>e.on(t,n),once:(t,n)=>e.once(t,n),off:(t,n)=>e.off(t,n)}};var Nn=kn.a.createContext(null);var Hn=e=>(Object(O.invariant)(!Object(Bn.a)(),"Uploady - Valid UploadyContext not found.\nYou may be using packages of different Uploady versions. <Uploady> and all other packages using the context provider must be of the same version: %s",Object(Bn.b)()),Object(O.invariant)(e&&e.hasUploader(),"Uploady - Valid UploadyContext not found. Make sure you render inside <Uploady>"),e);var xn=()=>Hn(Object(jn.useContext)(Nn));const qn=(e,t)=>{const n=xn(),{on:r,off:o}=n;Object(jn.useEffect)(()=>(r(e,t),()=>{o(e,t)}),[e,t,r,o])},Mn=(e,t)=>(n,r)=>{const[o,a]=Object(jn.useState)(null);n&&!Object(O.isFunction)(n)&&(r=n,n=void 0);const s=Object(jn.useCallback)((function(e){if(!r||e.id===r){for(var o=arguments.length,s=new Array(o>1?o-1:0),i=1;i<o;i++)s[i-1]=arguments[i];a(t(e,...s)),Object(O.isFunction)(n)&&n(e,...s)}}),[n,r]);return qn(e,s),o},$n=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(n,r)=>{const o=Object(jn.useCallback)((function(e){for(var o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return!n||t&&r&&e.id!==r?void 0:n(e,...a)}),[n,r]);qn(e,o)}},zn=$n(qe.BATCH_ADD,!1),Gn=$n(qe.BATCH_START),Wn=$n(qe.BATCH_FINISH),Vn=$n(qe.BATCH_CANCEL),Kn=$n(qe.BATCH_ERROR),Xn=$n(qe.BATCH_FINALIZE),Yn=$n(qe.BATCH_ABORT),Qn=Mn(qe.BATCH_PROGRESS,e=>({...e})),Zn=$n(qe.ITEM_START),Jn=$n(qe.ITEM_FINISH),er=$n(qe.ITEM_CANCEL),tr=$n(qe.ITEM_ERROR),nr=$n(qe.ITEM_ABORT),rr=$n(qe.ITEM_FINALIZE),or=Mn(qe.ITEM_PROGRESS,e=>({...e})),ar=$n(qe.REQUEST_PRE_SEND,!1),sr=$n(qe.ALL_ABORT,!1),ir=Symbol.for("rpldy_component"),ur=(e,t)=>{Object(O.isProduction)()||e||console.warn(t)},dr=e=>{e[ir]=!0},cr=e=>{var t,n;return!0===e[ir]||!0===(null===(t=e.target)||void 0===t?void 0:t[ir])||!0===(null===(n=e.render)||void 0===n?void 0:n[ir])};var lr=(e,t)=>{const n=Object(jn.useMemo)(()=>(O.logger.debugLog("Uploady creating a new uploader instance",e),Ft(e)),[e.enhancer]);return n.update(e),Object(jn.useEffect)(()=>(t&&(O.logger.debugLog("Uploady setting event listeners",t),Object.entries(t).forEach(e=>{let[t,r]=e;n.on(t,r)})),()=>{t&&(O.logger.debugLog("Uploady removing event listeners",t),Object.entries(t).forEach(e=>{let[t,r]=e;return n.off(t,r)}))}),[t,n]),n};var fr=e=>{const{listeners:t,debug:n,children:r,inputRef:o,...a}=e;O.logger.setDebug(!!n),O.logger.debugLog("@@@@@@ Uploady Rendering @@@@@@",e);const s=lr(a,t),i=Object(jn.useMemo)(()=>Fn(s,o),[s,o]);return kn.a.createElement(Nn.Provider,{value:i},r)};var pr=e=>{const t=xn();return e&&t.setOptions(e),t.getOptions()};var gr=()=>{const e=xn();return Object(jn.useCallback)(t=>e.abort(t),[e])};var hr=()=>{const e=xn();return Object(jn.useCallback)(t=>e.abortBatch(t),[e])};var br=()=>{const e=xn();return Object(jn.useCallback)(()=>e.abort(),[e])};const mr=e=>{let{eventType:t,getIsValidEventData:n,getRequestData:r}=e;return e=>o=>{const a=xn(),[s,i]=Object(jn.useState)({updateRequest:null,requestData:null}),{id:u}=o;return Object(jn.useLayoutEffect)(()=>{const e=function(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];return!0===n(u,...s)?new Promise(n=>{i({updateRequest:r=>{a.off(t,e),n(r)},requestData:r(...s)})}):void 0};return u&&a.on(t,e),()=>{u&&a.off(t,e)}},[a,u]),kn.a.createElement(e,Un()({},o,s))}};var Sr=mr({eventType:qe.REQUEST_PRE_SEND,getIsValidEventData:(e,t)=>{let{items:n}=t;return!!n.find(t=>t.id===e)},getRequestData:e=>{let{items:t,options:n}=e;return{items:t,options:n}}});var Er=mr({eventType:qe.BATCH_START,getIsValidEventData:(e,t)=>t.id===e,getRequestData:(e,t)=>({batch:e,items:e.items,options:t})}),vr=n("faye"),Tr=n.n(vr);const Or=(e,t,n)=>kn.a.createElement("input",Un()({},e,{name:t.inputFieldName,type:"file",ref:n})),yr=Object(jn.memo)(Object(jn.forwardRef)((e,t)=>{let{container:n,noPortal:r,...o}=e;const a=pr(),s=n&&1===n.nodeType;return Object(O.invariant)(s||!Object(O.hasWindow)(),"Uploady - Container for file input must be a valid dom element"),r?Or(o,a,t):((e,t,n,r,o)=>e&&t?Tr.a.createPortal(Or(n,r,o),e):null)(n,s,o,a,t)}));var Ar=e=>{const{multiple:t=!0,capture:n,accept:r,webkitdirectory:o,children:a,inputFieldContainer:s,customInput:i,fileInputId:u,noPortal:d=!1,...c}=e,l=i?null:s||(Object(O.hasWindow)()?document.body:null),f=Object(jn.useRef)();return kn.a.createElement(fr,Un()({},c,{inputRef:f}),i?null:kn.a.createElement(yr,{container:l,multiple:t,capture:n,accept:r,webkitdirectory:o,style:{display:"none"},ref:f,id:u,noPortal:d}),a)};const Ir=e=>{const t=e.closest("form");let n={filesParamName:e.getAttribute("name"),method:void 0,url:void 0};if(t){const e=t.getAttribute("method"),r=(e=>{const t=window.location;let n,r=e.getAttribute("action")||"";switch(r=r.replace(/\s/g,""),!0){case""===r:r=t.href;break;case r.startsWith("/"):r=`${t.protocol}//${t.host}${r}`;break;case!/:\/\//.test(r):n=t.pathname.split("/").slice(0,-1).concat("").join("/"),r=`${t.protocol}//${t.host}${n}${r}`}return r})(t);n.method=e?e.toUpperCase():void 0,n.url=r,O.logger.debugLog(`Uploady.useFileInput: using custom input's parent form url ${n.url} and method ${n.method||""}`)}return n};var Lr=e=>{const t=xn();return e&&t.setExternalFileInput(e),Object(jn.useEffect)(()=>{if(null!=e&&e.current&&"closest"in e.current){const n=e.current,r=t.getOptions();if(!r.destination||!r.destination.url){const e=Ir(n);t.setOptions({destination:e})}}},[e,t]),e||t.getInternalFileInput()},Rr=Ar;ur(B||!Object(O.hasWindow)(),"This browser doesn't support chunking. Consider using @rpldy/uploady instead");var _r=e=>{const{chunked:t,chunkSize:n,retries:r,parallel:o,...a}=e,s=Object(jn.useMemo)(()=>B?((e,t)=>{const n=ge(e);return t?Bt(n,t):n})({chunked:t,chunkSize:n,retries:r,parallel:o},e.enhancer):void 0,[e.enhancer,t,n,r,o]);return kn.a.createElement(Rr,Un()({},a,{enhancer:s}))};const Cr=$n(Y.CHUNK_START,!1),wr=$n(Y.CHUNK_FINISH,!1);var Pr=_r;const Dr="Uploady - retry was not registered. Make sure you used the enhancer";var Ur=()=>{const e=xn().getExtension(Nt);return Object(O.invariant)(e,Dr),e.retry};var jr=()=>{const e=xn().getExtension(Nt);return Object(O.invariant)(e,Dr),e.retryBatch};var kr=$n(Ht,!1),Br=$t;ur(B,"This browser doesn't support chunking. Consider using @rpldy/uploady instead");var Fr=e=>{const{chunked:t,chunkSize:n,retries:r,parallel:o,version:a,featureDetection:s,featureDetectionUrl:i,onFeaturesDetected:u,resume:d,deferLength:c,overrideMethod:l,sendDataOnCreate:f,storagePrefix:p,lockedRetryDelay:g,forgetOnSuccess:h,ignoreModifiedDateInStorage:b,...m}=e,S=Object(jn.useMemo)(()=>B?((e,t)=>{const n=wn(e);return t?Bt(n,t):n})({chunked:t,chunkSize:n,retries:r,parallel:o,version:a,featureDetection:s,featureDetectionUrl:i,onFeaturesDetected:u,resume:d,deferLength:c,overrideMethod:l,sendDataOnCreate:f,storagePrefix:p,lockedRetryDelay:g,forgetOnSuccess:h,ignoreModifiedDateInStorage:b},e.enhancer):void 0,[e.enhancer,t,n,r,o,a,s,i,u,d,c,l,f,p,g,h,b]);return kn.a.createElement(Rr,Un()({},m,{enhancer:S}))};var Nr=()=>{const e=xn().getExtension(Jt);return Object(O.invariant)(e,"Uploady - tus was not registered. Make sure you used the enhancer"),()=>Zt(e.getOptions())},Hr=Fr;var xr=e=>{const t=(t,n)=>{const{showFileUpload:r}=xn(),{id:o,className:a,text:s,children:i,extraProps:u,onClick:d,...c}=t,l=Object(jn.useRef)();l.current=c;const f=Object(jn.useCallback)(e=>{r(l.current),null==d||d(e)},[r,l,d]);return kn.a.createElement(e,Un()({ref:n,onClick:f,id:o,className:a,children:i||s||"Upload"},u))};return dr(t),Object(jn.forwardRef)(t)};var qr=xr(Object(jn.forwardRef)((e,t)=>kn.a.createElement("button",Un()({ref:t},e)))),Mr=qr,$r=n("ALC1");const zr=Object(jn.forwardRef)((e,t)=>{let{className:n,id:r,children:o,onDragOverClassName:a,dropHandler:s,htmlDirContentParams:i,extraProps:u,...d}=e;const{upload:c}=xn(),l=Object(jn.useRef)(null),f=Object(jn.useRef)(!1);Object(jn.useImperativeHandle)(t,()=>l.current,[]);const p=Object(jn.useRef)();p.current=d;const g=Object(jn.useCallback)(()=>{f.current=!1,l.current&&a&&l.current.classList.remove(a)},[a,l]),h=Object(jn.useCallback)(e=>s?Promise.resolve(s(e)):Object($r.getFilesFromDragEvent)(e,i||{}),[s,i]),b=Object(jn.useCallback)(e=>{h(e).then(e=>{c(e,p.current)})},[c,h,p]),m=Object(jn.useCallback)(e=>{f.current=!f.current&&e.target===l.current,l.current&&a&&l.current.classList.add(a)},[a,l]),S=Object(jn.useCallback)(e=>{e.preventDefault()},[]),E=Object(jn.useCallback)(e=>{e.preventDefault(),e.persist(),g(),b(e)},[g,b]),v=Object(jn.useCallback)(e=>{f.current&&e.target===l.current&&g()},[g,l]),T=Object(jn.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),g()},[g]);return kn.a.createElement("div",Un()({id:r,className:n,ref:l,onDragOver:S,onDragEnter:m,onDrop:E,onDragLeave:v,onDragEnd:T},u),o)});dr(zr);var Gr=zr,Wr=Gr;var Vr=(e,t)=>{const{upload:n}=xn(),r=Object(jn.useRef)();return r.current=e,Object(jn.useCallback)(e=>{var o;const a=null===(o=e.clipboardData)||void 0===o?void 0:o.files;null!=a&&a.length&&(n(a,r.current),null==t||t({count:a.length}))},[n,r,t])};var Kr=e=>Object(jn.forwardRef)((t,n)=>{const{id:r,className:o,children:a,onPasteUpload:s,extraProps:i,...u}=t,d=Vr(u,s),c=cr(e)?{...u,extraProps:{...i,onPaste:d}}:{...i,onPaste:d};return kn.a.createElement(e,Un()({ref:n,id:r,className:o},c),a)});const Xr=(e,t)=>{(e||window).addEventListener("paste",t)},Yr=(e,t)=>{(e||window).removeEventListener("paste",t)};var Qr=(e,t,n)=>{const r=Object(jn.useRef)(!0),o=Vr(e,n),a=Object(jn.useCallback)(()=>{const e=null==t?void 0:t.current;return r.current=!r.current,r.current?Xr(e,o):Yr(e,o),r.current},[t,o]),s=Object(jn.useCallback)(()=>r.current,[]);return Object(jn.useEffect)(()=>{const e=null==t?void 0:t.current;return r.current&&Xr(e,o),()=>{r.current&&Yr(e,o)}},[t,o]),{toggle:a,getIsEnabled:s}},Zr=Kr;const Jr={IMAGE:"image",VIDEO:"video"},eo=Object(O.devFreeze)({rememberPreviousBatches:!1,loadFirstOnly:!1,maxPreviewImageSize:2e7,maxPreviewVideoSize:1e8,fallbackUrl:"",imageMimeTypes:["image/jpeg","image/webp","image/gif","image/png","image/apng","image/bmp","image/x-icon","image/svg+xml"],videoMimeTypes:["video/mp4","video/webm","video/ogg"],previewComponentProps:void 0}),to=(e,t)=>{let n=Object(O.isFunction)(e)?e(t):e;return"string"==typeof n&&(n={id:"",url:n,name:t.name,type:Jr.IMAGE}),n},no=(e,t,n,r)=>{let o;return t&&~t.indexOf(r.type)&&(!n||r.size<=n)&&(o={url:URL.createObjectURL(r),name:r.name,type:e}),o},ro=(e,t,n,r)=>Object(O.isFunction)(e)?e(t,n,r):e,oo=(e,t)=>{let n,r=!1;if(e.file){const o=e.file;n=((e,t)=>{let n=no(Jr.IMAGE,t.imageMimeTypes,t.maxPreviewImageSize||0,e);return n||(n=no(Jr.VIDEO,t.videoMimeTypes,t.maxPreviewVideoSize||0,e)),n})(e.file,t),n||(n=to(t.fallbackUrl,o),r=!0)}else n={url:e.url,name:e.url,type:Jr.IMAGE};return n&&{...n,id:e.id,isFallback:r}},ao=(e,t)=>{const n=[];return t.forEach(t=>{const r=e.findIndex(e=>e.id===t.id);~r?e.splice(r,1,t):n.push(t)}),e.concat(n)},so=e=>t=>{const n=t.previewComponentProps,[r,o]=Object(jn.useState)({previews:[],items:[]}),a=(s=t,{...eo,...s});var s;const i=Object(jn.useCallback)(()=>{o({previews:[],items:[]})},[]);e(e=>{const n=a.loadFirstOnly?e.items.slice(0,1):e.items,s=n.map(e=>oo(e,a)).filter(Boolean);o({previews:t.rememberPreviousBatches?ao(r.previews,s):s,items:t.rememberPreviousBatches?r.items.concat(n):n})});return{previews:Object(jn.useMemo)(()=>((e,t,n)=>{let r=e;return n&&(r=e.map(e=>({...e,props:ro(n,t.find(t=>{let{id:n}=t;return n===e.id}),e.url,e.type)}))),r})(r.previews,r.items,n),[r,n]),clearPreviews:i}},io=(e,t,n,r)=>e===Jr.VIDEO?kn.a.createElement("video",Un()({key:t,src:t,controls:!0},n)):kn.a.createElement("img",Un()({key:t,onError:r,src:t},n)),uo=(e,t,n,r)=>{Object(jn.useImperativeHandle)(n,()=>({clear:t}),[t]),Object(jn.useEffect)(()=>{r&&r(e)},[e,r])},co=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gn;const t=so(e);return e=>{const{PreviewComponent:n,previewMethodsRef:r,onPreviewsChanged:o,...a}=e,{previews:s,clearPreviews:i}=t(a),u=Object(jn.useCallback)(t=>{const n=t.target,r=to(e.fallbackUrl,n.src);r&&(n.src=r.url)},[e.fallbackUrl]);return uo(s,i,r,o),s.map(e=>{const{id:t,url:r,type:o,name:a,isFallback:s,props:i}=e;return n?kn.a.createElement(n,Un()({key:t+r,id:t,url:r,type:o,name:a,isFallback:s},i)):io(o,r,i,u)})}};var lo=co(),fo=lo;const po=Object(jn.forwardRef)((e,t)=>{const n=Object(jn.useRef)(null),r=xn(),{className:o,id:a,placeholder:s,uploadRef:i,validate:u,ignoreKeyPress:d,...c}=e,l=Object(jn.useRef)();l.current=c,Object(jn.useImperativeHandle)(t,()=>n.current,[]);const f=Object(jn.useCallback)(()=>{const e=n.current,t=null==e?void 0:e.value;(u?u(t,e):t)&&r.upload(t,l.current)},[r,u,l,n]),p=Object(jn.useCallback)(e=>{d||"Enter"!==e.key||f()},[f,d]);return Object(jn.useImperativeHandle)(i,()=>f,[f]),kn.a.createElement("input",{type:"text",id:a,ref:n,className:o,onKeyPress:p,placeholder:s})});dr(po);var go=po,ho=po},cDcd:function(t,n){t.exports=e},faye:function(e,n){e.exports=t},"mHo/":function(e,t,n){"use strict";n.r(t),n.d(t,"BATCH_STATES",(function(){return u})),n.d(t,"FILE_STATES",(function(){return d})),n.d(t,"invariant",(function(){return a.a})),n.d(t,"throttle",(function(){return i.a})),n.d(t,"logger",(function(){return r})),n.d(t,"triggerCancellable",(function(){return h})),n.d(t,"triggerUpdater",(function(){return m})),n.d(t,"createBatchItem",(function(){return y})),n.d(t,"request",(function(){return L})),n.d(t,"parseResponseHeaders",(function(){return I})),n.d(t,"isFunction",(function(){return _.a})),n.d(t,"isPlainObject",(function(){return U})),n.d(t,"isSamePropInArrays",(function(){return C})),n.d(t,"devFreeze",(function(){return D})),n.d(t,"merge",(function(){return F})),n.d(t,"getMerge",(function(){return B})),n.d(t,"clone",(function(){return N})),n.d(t,"pick",(function(){return H})),n.d(t,"hasWindow",(function(){return c})),n.d(t,"isProduction",(function(){return P.a})),n.d(t,"isPromise",(function(){return x}));var r={};n.r(r),n.d(r,"isDebugOn",(function(){return f})),n.d(r,"setDebug",(function(){return p})),n.d(r,"debugLog",(function(){return g}));var o=n("kvau"),a=n.n(o),s=n("uDTZ"),i=n.n(s);const u={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted",ERROR:"error"},d={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"};var c=()=>"object"==typeof window&&!!window.document;let l;const f=()=>("boolean"!=typeof l&&(l=c()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||!0===window["__rpldy-logger-debug__"])),!!l),p=e=>{c()&&(window["__rpldy-logger-debug__"]=e),l=!!e||null},g=function(){f()&&console.log(...arguments)};var h=function(e,t){const n=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new Promise((n,o)=>{const a=e(t,...r);a&&a.length?Promise.all(a).catch(o).then(e=>e&&n(!!~e.findIndex(e=>!1===e))):n(!1)})};for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return t?n(t,...o):n};const b=e=>null==e;var m=function(e,t){const n=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new Promise((n,o)=>{const a=e(t,...r);a&&a.length?Promise.all(a).catch(o).then(e=>{let t;if(e)for(;b(t)&&e.length;)t=e.pop();n(b(t)?void 0:t)}):n()})};for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return t?n(t,...o):n};const S=Symbol.for("__rpldy-bi__");let E=0;const v=(e,t)=>(e.url=t,e),T=(e,t)=>(e.file=t,e),O=e=>e&&(e instanceof File||e instanceof Blob||"object"==typeof e&&e.name&&e.type);var y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];E+=e.id&&e.batchId?0:1;const r=e.id&&e.batchId?e.id:`${t}.item-${E}`,o=n?d.PENDING:d.ADDED;let a={id:r,batchId:t,state:o,uploadStatus:0,completed:0,loaded:0,recycled:!1,previousBatch:null};if(Object.defineProperty(a,S,{value:!0,writable:!0}),"object"==typeof e&&!0===e[S]&&(a.recycled=!0,a.previousBatch=e.batchId,e=e.file||e.url),"string"==typeof e)a=v(a,e);else{if(!O(e))throw new Error("Unknown type of file added: "+typeof e);a=T(a,e)}return a};const A=(e,t)=>{t&&Object.keys(t).forEach(n=>{void 0!==t[n]&&e.setRequestHeader(n,t[n])})};var I=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((e,t)=>{const[n,r]=t.split(": ");return e[n]=r,e},{})}catch(t){g("uploady.request: failed to read response headers",e)}return t},L=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new XMLHttpRequest,o=new Promise((o,a)=>{r.onerror=()=>a(r),r.ontimeout=()=>a(r),r.onabort=()=>a(r),r.onload=()=>o(r),r.open(n.method||"GET",e),A(r,n.headers),r.withCredentials=!!n.withCredentials,n.preSend&&n.preSend(r),r.send(t)});return o.xhr=r,o},R=n("r5yn"),_=n.n(R);var C=(e,t,n)=>{let r=!0;const o=(e=>{const t=[].concat(e);return e=>e.map(e=>t.map(t=>e[t]).join())})(n);if(e&&t&&e.length===t.length){const n=o(e),a=o(t);r=!!n.find((e,t)=>e!==a[t])}return!r},w=n("DVTP"),P=n.n(w);var D=e=>P()()?e:Object.freeze(e);var U=e=>{var t;return!!e&&"object"==typeof e&&("Object"===(null===(t=Object.getPrototypeOf(e))||void 0===t?void 0:t.constructor.name)||null===Object.getPrototypeOf(e))};const j=e=>U(e)||Array.isArray(e),k=(e,t)=>{const n=Object.keys(e);return t.withSymbols?n.concat(Object.getOwnPropertySymbols(e)):n},B=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n&&o.length&&o.forEach(r=>{r&&k(r,e).forEach(o=>{const a=r[o];e.predicate&&!e.predicate(o,a)||(void 0!==a||e.undefinedOverwrites)&&(j(a)?(void 0!==n[o]&&U(n[o])||(n[o]=Array.isArray(a)?[]:{}),t(n[o],a)):n[o]=a)})}),n};return t};var F=B();var N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F;return j(e)?t(Array.isArray(e)?[]:{},e):e};var H=(e,t)=>e&&Object.keys(e).reduce((n,r)=>(~t.indexOf(r)&&(n[r]=e[r]),n),{});var x=e=>!!e&&"object"==typeof e&&"function"==typeof e.then},r5yn:function(e,t){e.exports=function(e){return"function"==typeof e}}})}));
//# sourceMappingURL=rpldy-all.umd.min.js.map